<html>
<head>
<script src="jquery-2.1.3.min.js"></script>

</head>
<body>

  <!--home template-->
  <div id="show-grid">
    <h2>Shows</h2>

    <ul id="shows">
    </ul>
  </div>

  <!--show detail template-->
  <div id="show">
    <a href="/">shows</a>
    <a href="#" onclick="showSeasons()">seasons</a>
    <h2 class="title"></h2>

    <ul id="seasons">
    </ul>
    <ul id="episodes">
    </ul>
  </div>

  <script type="text/javascript">
    function showSeasons() {
      $('#seasons').show();
      $('#episodes').hide();
    }

    function appendEpisodeToList(episode) {
      elm = $("<li>"+episode.title+"</li>");
      $("#episodes").append(elm);
    }

    function listEpisodes(data) {
      for (episode of data) {
        appendEpisodeToList(episode)
      }
    }

    function getEpisodes(season) {
      url = season.url.replace(/Videos\//,''); //FIXME the generated JSON should obmit the 'Videos' prefix.
      url = url.replace(/\.json/, '/episodes.json')
      $.get(url, listEpisodes);
    }

    function displaySeason(season) {
      $("#seasons").hide();
      $('#episodes').show();
      $("#episodes").empty();
      getEpisodes(season);
    }

    function appendSeasonToList(season) {
      elm = $("<li>"+season.number+"</li>");
      elm.click(function() {
        displaySeason(season);
      });
      $("#seasons").append(elm);
    }

    function listSeasons(data) {
      for (season of data) {
        appendSeasonToList(season);
      }
    }

    function getSeasons(show) {
      url = show.title + "/seasons.json"; //FIXME the generated JSON should point to this file.
      $.get(url, listSeasons);
    }

    function displayShow(show) {
      $("#show-grid").hide();
      $("#show .title").html(show.title);
      $("#seasons").empty();
      $("#episodes").empty();
      getSeasons(show)
    }

    function appendShowToList(show) {
      elm = $("<li>"+show.title+"</li>");
      elm.click(function() {
        displayShow(show);
      });
      $("#shows").append(elm);
    }

    function listShows(data) {
      for (show of data) {
        appendShowToList(show);
      }
    }

    function getShows() {
      $.get('shows.json', listShows);
    }

    getShows();

  </script>

</body>
</html>
